<!DOCTYPE html>
<html lang="pt">
<head>
<meta charset="UTF-8">
<title>Controle de Dívidas</title>
<style>
  body { font-family: Arial; background: #f4f7f9; padding: 20px; }
  h2 { text-align: center; margin-bottom: 20px; }
  form, #filtros, #tabelaDividas { background: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 0 10px rgba(0,0,0,0.1); margin-bottom: 20px; }
  input, select, button { width: 100%; padding: 8px; margin-bottom: 10px; border-radius: 4px; border: 1px solid #ccc; }
  button { background: #0077ff; color: white; border: none; cursor: pointer; }
  button:hover { background: #005ec2; }
  table { width: 100%; border-collapse: collapse; }
  th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
  th { background: #0077ff; color: white; }
  .pendente { background-color: #ffe5e5; color: #d8000c; font-weight: bold; }
  .pago { background-color: #e5ffe5; color: #007a00; font-weight: bold; }
</style>
</head>
<body>

<h2>Controle de Dívidas</h2>

<!-- Formulário -->
<form id="dividaForm">
  <input type="text" id="nome" placeholder="Nome" required>
  <input type="text" id="fornecedor" placeholder="Fornecedor" required>
  <input type="text" id="material" placeholder="Material" required>
  <input type="number" id="quantidade" placeholder="Quantidade" step="0.01" required>
  <input type="number" id="preco" placeholder="Preço" step="0.01" required>
  <input type="text" id="precoTotal" placeholder="Preço Total" readonly>
  <select id="status" required>
    <option value="">Status</option>
    <option value="Pendente">Pendente</option>
    <option value="Pago">Pago</option>
  </select>
  <button type="submit">Salvar Dívida</button>
</form>

<!-- Filtro -->
<div id="filtros">
  <label>Filtrar por Status:</label>
  <select id="filtroStatus">
    <option value="Todos">Todos</option>
    <option value="Pendente">Pendente</option>
    <option value="Pago">Pago</option>
  </select>
</div>

<!-- Tabela -->
<div id="tabelaDividas">
  <table id="dividasTable">
    <thead>
      <tr>
        <th>Data</th>
        <th>Nome</th>
        <th>Fornecedor</th>
        <th>Material</th>
        <th>Quantidade</th>
        <th>Preço</th>
        <th>Preço Total</th>
        <th>Status</th>
      </tr>
    </thead>
    <tbody>
      <!-- Dados serão inseridos aqui -->
    </tbody>
  </table>
</div>

<script>
const form = document.getElementById("dividaForm");
const quantidadeInput = document.getElementById("quantidade");
const precoInput = document.getElementById("preco");
const precoTotalInput = document.getElementById("precoTotal");
const filtroStatus = document.getElementById("filtroStatus");
const tabelaBody = document.querySelector("#dividasTable tbody");

// Substitua pela URL do seu Web App
const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbzaDoL5FIiWOM12CAWhYlunazqBeQBZLJahwUBqxW2MLEyFnXTYCNYPxV7c0LF4sQJU/exec";

// Atualiza Preço Total automaticamente
function atualizarPrecoTotal() {
  const quantidade = parseFloat(quantidadeInput.value) || 0;
  const preco = parseFloat(precoInput.value) || 0;
  precoTotalInput.value = (quantidade * preco).toFixed(2);
}
quantidadeInput.addEventListener("input", atualizarPrecoTotal);
precoInput.addEventListener("input", atualizarPrecoTotal);

// Salvar dívida
form.addEventListener("submit", e => {
  e.preventDefault();
  
  const data = {
    nome: document.getElementById("nome").value,
    fornecedor: document.getElementById("fornecedor").value,
    material: document.getElementById("material").value,
    quantidade: quantidadeInput.value,
    preco: precoInput.value,
    status: document.getElementById("status").value
  };

  fetch(WEB_APP_URL, {
    method: "POST",
    body: JSON.stringify(data),
    headers: { "Content-Type": "application/json" }
  })
  .then(response => response.json())
  .then(res => {
    alert("Dívida registrada com sucesso!");
    form.reset();
    precoTotalInput.value = "";
    carregarDividas(); // Atualiza tabela
  })
  .catch(err => {
    console.error(err);
    alert("Erro ao salvar dívida.");
  });
});

// Carrega dívidas
async function carregarDividas() {
  const response = await fetch(WEB_APP_URL + "?action=get"); 
  const dividas = await response.json();

  tabelaBody.innerHTML = "";
  const statusFiltro = filtroStatus.value;

  dividas.forEach(d => {
    if (statusFiltro === "Todos" || d.status === statusFiltro) {
      const tr = document.createElement("tr");
      tr.className = d.status.toLowerCase(); // pendente ou pago
      tr.innerHTML = `
        <td>${d.data}</td>
        <td>${d.nome}</td>
        <td>${d.fornecedor}</td>
        <td>${d.material}</td>
        <td>${d.quantidade}</td>
        <td>${d.preco}</td>
        <td>${d.precoTotal}</td>
        <td>${d.status}</td>
      `;
      tabelaBody.appendChild(tr);
    }
  });
}

// Atualiza a tabela ao mudar filtro
filtroStatus.addEventListener("change", carregarDividas);

// Carrega tabela ao abrir
carregarDividas();

</script>
</body>
</html>
