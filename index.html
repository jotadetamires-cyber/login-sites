<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8">
  <title>Gestão de Fornecimentos</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    table { border-collapse: collapse; width: 100%; margin-top: 20px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
    th { background: #f2f2f2; }
    button { padding: 6px 12px; margin: 2px; cursor: pointer; border-radius: 5px; }
    .btnPago { background: #4CAF50; color: white; border: none; }
    .btnEliminar { background: #f44336; color: white; border: none; }
  </style>
</head>
<body>
  <h2>Gestão de Fornecimentos</h2>

  <form id="form">
    <input type="text" id="nome" placeholder="Nome do Fornecedor" required>
    <input type="date" id="data" required>
    <input type="text" id="produto" placeholder="Produto" required>
    <input type="number" id="quantidade" placeholder="Quantidade" required>
    <input type="number" id="preco" placeholder="Preço" required>
    <button type="submit">Adicionar</button>
  </form>

  <!-- Botão para eliminar não pagos -->
  <button id="btnEliminarTodos" class="btnEliminar">Eliminar Não Pagos</button>

  <table id="tabela">
    <thead>
      <tr>
        <th>#</th>
        <th>Fornecedor</th>
        <th>Data</th>
        <th>Produto</th>
        <th>Quantidade</th>
        <th>Preço</th>
        <th>Total</th>
        <th>Status</th>
        <th>Ações</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

<script>
const form = document.getElementById("form");
const tabela = document.querySelector("#tabela tbody");
const scriptURL = "URL_DO_SEU_SCRIPT"; // <-- coloca aqui o URL do Google Apps Script

let fornecimentos = JSON.parse(localStorage.getItem("fornecimentos")) || [];

// Salvar no LocalStorage
function salvarLocal() {
  localStorage.setItem("fornecimentos", JSON.stringify(fornecimentos));
}

// Renderizar tabela
function atualizarTabela() {
  tabela.innerHTML = "";
  fornecimentos.forEach((f, i) => {
    let row = tabela.insertRow();
    row.insertCell(0).textContent = i + 1;
    row.insertCell(1).textContent = f.nome;
    row.insertCell(2).textContent = f.data;
    row.insertCell(3).textContent = f.produto;
    row.insertCell(4).textContent = f.quantidade;
    row.insertCell(5).textContent = f.preco;
    row.insertCell(6).textContent = (f.quantidade * f.preco).toFixed(2);
    row.insertCell(7).textContent = f.status;
    let acoes = row.insertCell(8);

    if (f.status === "Não Pago") {
      let btn = document.createElement("button");
      btn.textContent = "Marcar Pago";
      btn.className = "btnPago";
      btn.dataset.idx = i;
      btn.onclick = async () => {
        fornecimentos[i].status = "Pago";
        salvarLocal();
        row.cells[7].textContent = "Pago";
        row.cells[8].innerHTML = "";
        fetch(scriptURL, { method: "POST", body: JSON.stringify(fornecimentos[i]) });
      };
      acoes.appendChild(btn);
    }
  });
}

// Submissão do formulário
form.onsubmit = e => {
  e.preventDefault();
  let f = {
    nome: document.getElementById("nome").value,
    data: document.getElementById("data").value,
    produto: document.getElementById("produto").value,
    quantidade: +document.getElementById("quantidade").value,
    preco: +document.getElementById("preco").value,
    status: "Não Pago"
  };
  fornecimentos.push(f);
  salvarLocal();
  atualizarTabela();
  fetch(scriptURL, { method: "POST", body: JSON.stringify(f) });
  form.reset();
};

// Botão eliminar não pagos
document.getElementById("btnEliminarTodos").onclick = async () => {
  // Filtrar pagos
  const eliminados = fornecimentos.filter(f => f.status === "Não Pago");
  fornecimentos = fornecimentos.filter(f => f.status !== "Não Pago");
  salvarLocal();
  atualizarTabela();

  // Enviar lista para Google Script eliminar
  fetch(scriptURL, {
    method: "POST",
    body: JSON.stringify({ acao: "eliminarNaoPagos", dados: eliminados })
  });
};

// Inicializar tabela
atualizarTabela();
</script>
</body>
</html>
